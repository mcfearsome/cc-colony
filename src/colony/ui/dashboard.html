<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colony Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Oxygen', 'Ubuntu', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }

        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 22px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .sidebar {
            background: #252526;
            border-right: 1px solid #3e3e42;
            padding: 20px;
            overflow-y: auto;
        }

        .main {
            padding: 24px;
            overflow-y: auto;
            background: #1e1e1e;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 6px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .nav-item:hover {
            background: #2d2d30;
        }

        .nav-item.active {
            background: #094771;
            color: white;
            font-weight: 500;
        }

        .card {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .card h2 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #4ec9b0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #2d2d30;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #4ec9b0;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #4ec9b0;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: #858585;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-list, .agent-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item, .agent-item {
            display: grid;
            grid-template-columns: 40px 1fr auto;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #2d2d30;
            border-radius: 6px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .task-item:hover, .agent-item:hover {
            background: #353537;
            transform: translateX(2px);
        }

        .task-item.pending { border-left-color: #dcdcaa; }
        .task-item.in-progress { border-left-color: #4ec9b0; }
        .task-item.blocked { border-left-color: #f48771; }
        .task-item.completed { border-left-color: #608b4e; }

        .agent-item.running { border-left-color: #4ec9b0; }
        .agent-item.stopped { border-left-color: #858585; }
        .agent-item.error { border-left-color: #f48771; }

        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin: 0 auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .status-dot.pending { background: #dcdcaa; }
        .status-dot.in-progress { background: #4ec9b0; }
        .status-dot.blocked { background: #f48771; animation: none; }
        .status-dot.completed { background: #608b4e; animation: none; }
        .status-dot.running { background: #4ec9b0; }
        .status-dot.stopped { background: #858585; animation: none; }
        .status-dot.error { background: #f48771; animation: none; }

        .item-content {
            flex: 1;
        }

        .item-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
            color: #e0e0e0;
        }

        .item-meta {
            font-size: 12px;
            color: #858585;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .badge.critical { background: #f48771; color: #1e1e1e; }
        .badge.high { background: #dcdcaa; color: #1e1e1e; }
        .badge.medium { background: #569cd6; color: #fff; }
        .badge.low { background: #608b4e; color: #fff; }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #858585;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #858585;
        }

        .spinner {
            border: 3px solid #3e3e42;
            border-top: 3px solid #4ec9b0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>üêù</span>
                <span>Colony Dashboard</span>
            </h1>
            <div class="header-actions">
                <button onclick="refreshData()">üîÑ Refresh</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="nav-item active" onclick="showView('overview')" id="nav-overview">
                <span>üìä</span>
                <span>Overview</span>
            </div>
            <div class="nav-item" onclick="showView('tasks')" id="nav-tasks">
                <span>‚úÖ</span>
                <span>Tasks</span>
            </div>
            <div class="nav-item" onclick="showView('agents')" id="nav-agents">
                <span>ü§ñ</span>
                <span>Agents</span>
            </div>
        </div>

        <div class="main" id="main-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading colony data...</p>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentView = 'overview';
        let tasks = [];
        let agents = [];
        let stats = {};

        // Initialize
        async function init() {
            await loadData();
            showView('overview');

            // Auto-refresh every 5 seconds
            setInterval(refreshData, 5000);
        }

        async function loadData() {
            try {
                // Load using custom protocol
                const [tasksRes, agentsRes, statsRes] = await Promise.all([
                    fetch('colony://tasks'),
                    fetch('colony://agents'),
                    fetch('colony://stats')
                ]);

                tasks = await tasksRes.json();
                agents = await agentsRes.json();
                stats = await statsRes.json();

                console.log('Loaded data:', { tasks, agents, stats });
            } catch (error) {
                console.error('Error loading data:', error);

                // Fallback to mock data for development
                tasks = [];
                agents = [];
                stats = {
                    total_tasks: 0,
                    pending_tasks: 0,
                    in_progress_tasks: 0,
                    completed_tasks: 0,
                    blocked_tasks: 0,
                    total_agents: 0,
                    running_agents: 0,
                    idle_agents: 0,
                    error_agents: 0
                };
            }
        }

        function showView(view) {
            currentView = view;

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`nav-${view}`).classList.add('active');

            // Render view
            const main = document.getElementById('main-content');

            if (view === 'overview') {
                main.innerHTML = renderOverview();
            } else if (view === 'tasks') {
                main.innerHTML = renderTasks();
            } else if (view === 'agents') {
                main.innerHTML = renderAgents();
            }
        }

        function renderOverview() {
            return `
                <div class="card">
                    <h2>üìä Quick Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${stats.total_tasks || 0}</div>
                            <div class="stat-label">Total Tasks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.total_agents || 0}</div>
                            <div class="stat-label">Agents</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.in_progress_tasks || 0}</div>
                            <div class="stat-label">In Progress</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.completed_tasks || 0}</div>
                            <div class="stat-label">Completed</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>‚úÖ Recent Tasks</h2>
                    ${tasks.length > 0 ? renderTaskList(tasks.slice(0, 5)) :
                        '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No tasks yet. Create one to get started!</p></div>'}
                </div>

                <div class="card">
                    <h2>ü§ñ Active Agents</h2>
                    ${agents.length > 0 ? renderAgentList(agents.slice(0, 5)) :
                        '<div class="empty-state"><div class="empty-state-icon">ü§ñ</div><p>No agents running. Start colony to begin!</p></div>'}
                </div>
            `;
        }

        function renderTasks() {
            return `
                <div class="card">
                    <h2>‚úÖ All Tasks (${tasks.length})</h2>
                    ${tasks.length > 0 ? renderTaskList(tasks) :
                        '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No tasks found.</p></div>'}
                </div>
            `;
        }

        function renderAgents() {
            return `
                <div class="card">
                    <h2>ü§ñ All Agents (${agents.length})</h2>
                    ${agents.length > 0 ? renderAgentList(agents) :
                        '<div class="empty-state"><div class="empty-state-icon">ü§ñ</div><p>No agents found. Run <code>colony start</code> to begin.</p></div>'}
                </div>
            `;
        }

        function renderTaskList(taskList) {
            return `
                <div class="task-list">
                    ${taskList.map(task => `
                        <div class="task-item ${task.status}">
                            <div class="status-dot ${task.status}"></div>
                            <div class="item-content">
                                <div class="item-title">${task.title || task.id}</div>
                                <div class="item-meta">
                                    ${task.assigned_to ? `Assigned to: ${task.assigned_to}` : 'Unassigned'}
                                </div>
                            </div>
                            ${task.priority ? `<span class="badge ${task.priority}">${task.priority}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderAgentList(agentList) {
            return `
                <div class="agent-list">
                    ${agentList.map(agent => `
                        <div class="agent-item ${agent.status}">
                            <div class="status-dot ${agent.status}"></div>
                            <div class="item-content">
                                <div class="item-title">${agent.id}</div>
                                <div class="item-meta">
                                    ${agent.role || 'No role assigned'}
                                    ${agent.current_task ? ` ‚Ä¢ Working on: ${agent.current_task}` : ''}
                                </div>
                            </div>
                            <span class="badge medium">${agent.status}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function refreshData() {
            console.log('Refreshing data...');
            await loadData();
            showView(currentView);

            // Send refresh message to backend
            if (window.ipc) {
                window.ipc.postMessage('refresh:manual');
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
